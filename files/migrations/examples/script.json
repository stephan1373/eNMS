[
  {
    "code": "# The data can be sorted by:\n# - \"count\": how many times a function was called\n# - \"average_time\": how much time does the function take on average\n# - \"combined_time\": how much time did the function take in total\nSORT_BY = \"count\"\n\n# The data can be filtered by origin:\n# - If the origin is \"\", all the data is displayed\n# - Possible origins include: \"Environment\", \"Controller\",\n# \"Runner\", \"CustomApp\", \"RestApi\"\nORIGIN = \"\"\n\n# Number of entries to display\n# By default, we only display the 20 largest entries\nLIMIT = 20\n\ndata = sorted(\n    [\n        (name, entry)\n        for name, entry in vs.profiling.items()\n        if entry[\"class\"].startswith(ORIGIN)\n    ],\n    key=lambda item: item[1][SORT_BY],\n    reverse=True,\n)[:LIMIT]\n\nprint(\n    \"\\n\\n\".join(\n        f\"Function '{name}':\\n {vs.dict_to_string(data, depth=2)}\"\n        for name, data in data\n    )\n)\n",
    "creation_time": "2025-07-25 11:49:14.990787",
    "creator": "admin",
    "description": "Sort and display the profiling data stored in vs.profiling",
    "id": 1,
    "last_modified": "2025-07-25 11:49:14.990741",
    "last_modified_by": "admin",
    "name": "Display Profiling Data",
    "version": ""
  },
  {
    "code": "# Factory: create a new instance\n\ndevice = db.factory(\"device\", name=\"test\", model=\"IOS\", commit=True)\nprint(f\"Device '{device}' has been created\")\n\n# Fetch: retrieve instance from database\n\ndevice = db.fetch(\"device\", name=\"test\")\nprint(f\"Device '{device}' retrieved from database\")\n\n# Factory: edit existing instance\n# We use factory to update the \"model\" property of Washington\n\nprint(f\"Old model: {device.model}\")\ndevice = db.factory(\"device\", name=\"test\", model=\"EOS\")\nprint(f\"New model: {device.model}\")\n\n# Delete: erase instance from database\n\ndb.delete(\"device\", name=\"test\")\ndb.session.commit()\n\nget_deleted_device = db.fetch(\"device\", name=\"test\", allow_none=True)\n\nif get_deleted_device is None:\n    print(\"Device has been deleted\")\n",
    "creation_time": "2025-07-26 09:08:08.597839",
    "creator": "admin",
    "description": "Tests factory (for creating and editing), fetch, and delete",
    "id": 2,
    "last_modified": "2025-07-26 09:11:17.980857",
    "last_modified_by": "admin",
    "name": "Functions provided by eNMS",
    "version": ""
  },
  {
    "code": "from pathlib import Path\n\npath_folder = vs.file_path / \"test\"\npath_folder.mkdir(exist_ok=True)\n\nfor i in range(10000):\n    file_path = path_folder / f\"file{i}\"\n    file_path.touch()\n",
    "creation_time": "2025-07-26 09:11:08.608881",
    "creator": "admin",
    "description": "This script is used to optimize the \"scan_folder\" function.\nIt creates 10K files in a subfolder \"test\" of the \"files\" folder",
    "id": 3,
    "last_modified": "2025-07-26 09:11:08.608856",
    "last_modified_by": "admin",
    "name": "Scalability: create 10K files",
    "version": ""
  },
  {
    "code": "db.monitor_orm_statements = True\ndb.orm_statements.clear()\ndb.orm_statements_runtime.clear()\ndb.orm_statements_tracebacks.clear()\n",
    "creation_time": "2025-07-26 09:12:38.966690",
    "creator": "admin",
    "description": "This script starts the monitoring mechanism for SQL queries and clears the content of the dict used for the analysis.",
    "id": 4,
    "last_modified": "2025-07-26 09:12:38.966650",
    "last_modified_by": "admin",
    "name": "Query Monitoring: Start",
    "version": ""
  },
  {
    "code": "from itertools import batched\n\nentry = (\"changelog\", \"content\", \"admin\", vs.get_time())\nquery = \"INSERT INTO changelog (type, content, author, time) VALUES (?, ?, ?, ?)\"\nbatch_size = vs.database[\"transactions\"][\"batch_size\"]\nlog_size = 50_000_000\n\nenv.log(\"info\", f\"Starting to create Fake Changelogs ({log_size} logs)\")\n\nwith env.timer(\"Create Fake Changelogs\"):\n    changelogs = (entry for _ in range(log_size))\n    cursor = db.session.connection().connection.cursor()\n    for batch in batched(changelogs, batch_size):\n        cursor.executemany(query, batch)\n    db.session.commit()\n",
    "creation_time": "2025-07-26 09:14:56.501843",
    "creator": "admin",
    "description": "Uses low-level SQL to create many changelogs (50M by default)",
    "id": 5,
    "last_modified": "2025-07-26 09:14:56.501793",
    "last_modified_by": "admin",
    "name": "Create Fake Logs",
    "version": ""
  },
  {
    "code": "from datetime import datetime\n\ndevice_number = 200\n\nfactory_time = datetime.now()\nfor index in range(device_number):\n    db.factory(\"device\", name=str(index), commit=True)\nprint(f\"'db.factory' time: {datetime.now() - factory_time}\")\n\nfetch_time = datetime.now()\nfor index in range(device_number):\n    db.fetch(\"device\", name=str(index))\nprint(f\"'db.fetch' time: {datetime.now() - fetch_time}\")\n\ndelete_time = datetime.now()\nfor index in range(device_number):\n    db.delete(\"device\", name=str(index))\n    db.session.commit()\nprint(f\"'db.delete' time: {datetime.now() - delete_time}\")\n\nprint(f\"Total duration: {datetime.now() - factory_time}\")\n",
    "creation_time": "2025-07-26 09:15:33.006728",
    "creator": "admin",
    "description": "Uses eNMS fetch, factory and delete function to measure eNMS performances when querying the database.",
    "id": 6,
    "last_modified": "2025-07-26 09:15:38.131060",
    "last_modified_by": "admin",
    "name": "Scalability: tests fetch, factory and delete performance",
    "version": ""
  }
]